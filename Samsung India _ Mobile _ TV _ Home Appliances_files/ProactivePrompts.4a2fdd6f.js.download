((self||this)["webpackJsonp@sprinklr/chat-web-client"]=(self||this)["webpackJsonp@sprinklr/chat-web-client"]||[]).push([[46],{1091:function(e,t,r){var n=r(129),c=r(1595),a=r(127),s=r(199),i=r(1596),u=r(475),o=s((function(e){var t=u(e),r=n(e,i);return t===u(r)?t=void 0:r.pop(),r.length&&r[0]===e[0]?c(r,a(t,2)):[]}));e.exports=o},1092:function(e,t,r){var n=r(129),c=r(127),a=r(1006),s=r(806);e.exports=function(e,t){if(null==e)return{};var r=n(s(e),(function(e){return[e]}));return t=c(t),a(e,r,(function(e,r){return t(e,r[0])}))}},1595:function(e,t,r){var n=r(205),c=r(731),a=r(814),s=r(129),i=r(130),u=r(206),o=Math.min;e.exports=function(e,t,r){for(var l=r?a:c,b=e[0].length,d=e.length,O=d,E=Array(d),T=1/0,v=[];O--;){var g=e[O];O&&t&&(g=s(g,i(t))),T=o(g.length,T),E[O]=!r&&(t||b>=120&&g.length>=120)?new n(O&&g):void 0}g=e[0];var m=-1,h=E[0];e:for(;++m<b&&v.length<T;){var _=g[m],j=t?t(_):_;if(_=r||0!==_?_:0,!(h?u(h,j):l(v,j,r))){for(O=d;--O;){var f=E[O];if(!(f?u(f,j):l(e[O],j,r)))continue e}h&&h.push(j),v.push(_)}}return v}},1596:function(e,t,r){var n=r(211);e.exports=function(e){return n(e)?e:[]}},1847:function(e,t,r){"use strict";r.r(t),r.d(t,"default",(function(){return Xt}));var n=r(384),c=r.n(n),a=r(486),s=r.n(a),i=r(385),u=r(82),o=r.n(u),l=r(502),b=r.n(l),d=r(545),O=r.n(d),E=r(512),T=r.n(E),v=r(598),g=r(483),m=r(1018),h=r(641),_=r(569),j=r(454),f=r(524);const I="IDLE",p="TRACKING";var C=()=>{const{subscribe:e}=Object(_.a)(),t=Object(n.useCallback)((()=>({eventType:f.a.PAGE_VISIT,eventId:c.current,details:{title:Object(j.c)(),oldUrl:c.current,newUrl:a.current}})),[]),r=Object(m.useFirstMountState)(),c=Object(n.useRef)(""),a=Object(n.useRef)(Object(j.b)()),{loading:s,refetch:i}=Object(h.a)({payload:t(),skipQueryOnMount:!1});return Object(n.useEffect)((()=>{const r=e("pageVisitTrackerInPrompt",(e=>{let{currentUrl:r,previousUrl:n}=e;c.current=n,a.current=r,i(t())}));return()=>{r&&r()}}),[i]),{trackingStatus:r||s?p:I}};var S=()=>{const{refetch:e}=Object(h.a)({skipQueryOnMount:!0});Object(n.useEffect)((()=>{const t=()=>{const{visibilityState:t}=document;e({eventType:f.a.TAB_CHANGE,eventId:Object(j.b)(),details:{isActive:"visible"===t}})};return document.addEventListener("visibilitychange",t),()=>{document.removeEventListener("visibilitychange",t)}}),[e])};var y=()=>{const{refetch:e}=Object(h.a)({skipQueryOnMount:!0});Object(n.useEffect)((()=>{const t=()=>{e({eventType:f.a.TAB_CLOSE,eventId:Object(j.b)(),details:{}})};return window.addEventListener("beforeunload",t),()=>{window.removeEventListener("beforeunload",t)}}),[e])};var R=()=>(S(),y(),C()),L=r(423),N=r(430),A=r(15),k=r(491),P=r(563);const V=(new L.a).setUrl("/livechat/prompt/candidatePrompts").setType(N.a.POST).build(),D="ADD",w="REMOVE",U="RESET";var G=()=>{const{data:e,refetch:t,fetchMore:r,updateQuery:c}=Object(g.a)({query:V,skipQueryOnMount:!0}),a=R().trackingStatus===I,[s,i]=Object(n.useState)(a?void 0:{isSilent:!1}),u=Object(n.useContext)(v.a),o=Object(n.useRef)(a);o.current=a;const l=Object(n.useCallback)((e=>{if(!o.current)return void i({isSilent:e});return t({...Object(j.a)(),appId:Object(A.a)().appId},e?(e,t)=>b()(t,(e=>{const t=u.getActionState(e.interceptId,e.id);return t!==P.a.CLOSE&&t!==P.a.ENGAGE&&t!==P.a.SNOOZE})):void 0)}),[t]),d=Object(n.useCallback)((e=>{if(o.current)return r({...Object(j.a)(),appId:Object(A.a)().appId,...e},((e,t)=>O()([...e,...t],"id")));i({isSilent:!1})}),[]);Object(n.useEffect)((()=>{a&&s&&(l(s.isSilent),i(void 0))}),[a,s]);return[e,Object(n.useCallback)((e=>{switch(e.type){case D:return d(e.payload);case w:{const t=new Set(T()(e.payload.interceptIds));return c((e=>b()(e,(e=>!t.has(k.a.getId(e)))))),null}case U:return l(e.payload.silent);default:return null}}),[c])]};var M=c.a.createContext(void 0);var x=()=>Object(n.useContext)(M),H=r(956),F=r(442),$=r(436);const W=e=>`PROMPT_${F.a.getId(e)}_${Date.now()}_${Math.random().toString(16).substr(2,8)}`;let Q;const Z=()=>Q,B=()=>{Z().disconnect().then((()=>{Object($.a)("MQTT Client | Disconnected")})).catch((e=>{console.error("MQTT Client | Disconnection Error",e)}))};var Y=r(121),z=r(485);const K="ADD_INTERCEPT",J="REMOVE_INTERCEPT";var X=(e,t)=>{const r=Object(n.useMemo)((()=>({chatUser:z.a.getChatUser(t),userName:z.a.getChatSessionToken(t),inboxServerUrl:z.a.getProactiveInboxServerUrl(t),userInbox:z.a.getProactiveUserInbox(t)})),[t.chatUser,t.chatSessionToken,t.proactivePromptInboxServerUrl,t.proactiveUserInbox]);Object(n.useEffect)((()=>{(e=>{let{chatUser:t,userName:r,inboxServerUrl:n,userInbox:c}=e;const a=W(t);Q=new H.a({userName:r,clientId:a,inboxServerUrl:n,userInbox:c})})(r);try{(()=>{Z().connect().catch((e=>{console.error("MQTT Client | Connection Error",e)}));const e=Z();e.on("error",(()=>{Object($.a)("MQTT Client | Error")})),e.on("offline",(()=>{Object($.a)("MQTT Client | Offline")})),e.on("reconnect",(()=>{Object($.a)("MQTT Client | Reconnect")})),e.on("close",(()=>{Object($.a)("MQTT Client | Closed")}))})(),Z().subscribe().catch((e=>{console.error("MQTT client | Subscribe Error",e)})),Z().on("message",((t,r)=>{try{const t=JSON.parse(r.toString());e(t)}catch(n){Object(Y.b)(n)}}))}catch(t){Object(Y.b)(t),B()}return()=>{try{Z().unsubscribe()}catch(e){Object(Y.b)(e)}finally{B()}}}),[r,e])},q=r(413),ee=r.n(q),te=r(500),re=r.n(te),ne=r(490),ce=r(831),ae=r(125);const se=(new L.a).setUrl("/livechat/logging/log").setType(N.a.POST).build(),ie=e=>{const{message:t,userId:r}=e,n=`UI_${ae.a.getAppId(Object(A.a)())}_${r}_${re.a.v4()}`;return{message:t,timeStamp:Date.now(),clientId:n,url:Object(j.b)()}},ue={debug:ee.a,info:ee.a,error:ee.a,warning:ee.a,cleanup:ee.a},oe=c.a.createContext({debug:ee.a,info:ee.a,warning:ee.a,error:ee.a}),le=e=>{let{children:t}=e;const r=x(),c=z.a.getChatUser(r),a=(e=>{let{category:t,batch:r,log:c,skip:a,adapter:s,userId:i}=e;const[u]=Object(ne.a)(se,{ignoreResults:!0}),o=Object(n.useRef)(ue);return o.current=Object(n.useMemo)((()=>new ce.a(c||u,{batch:r,skip:a,adapter:s||ie})),[u,ie]),Object(n.useEffect)((()=>()=>{o.current.cleanup()}),[]),Object(n.useMemo)((()=>({debug:e=>o.current.debug({message:e,category:t,userId:i}),error:e=>o.current.error({message:e,category:t,userId:i}),info:e=>o.current.info({message:e,category:t,userId:i}),warning:e=>o.current.warning({message:e,category:t,userId:i})})),[t,i])})({category:"PROACTIVE_PROMPT",userId:F.a.getId(c),batch:!0});return Object(i.jsx)(oe.Provider,{value:a},t)},be=()=>Object(n.useContext)(oe);var de=r(439);var Oe=()=>{const{subscribe:e}=Object(_.a)(),t=x(),[r,c]=G(),a=be(),s=Object(A.b)();Object(n.useEffect)((()=>{c({type:U,payload:{}})}),[c,t]);const i=Object(n.useCallback)((e=>{switch(e.payload.type){case K:c({type:D,payload:{variables:e.payload.variables}});break;case J:c({type:w,payload:{interceptIds:e.payload.interceptIds}})}}),[c]);return X(i,t),Object(n.useEffect)((()=>{const t=e("fetchCandidatePromptBaseOnUrlChange",(()=>{c({type:U,payload:{silent:!0}})}));return()=>{t&&t()}}),[c]),Object(n.useEffect)((()=>{const e=e=>{if(e.response&&e.response.data&&e.response.data.eventType===de.a.USER_PROFILE_UPDATED.id)return c({type:U,payload:{silent:!0}})};return s.sprChat("subscribeToUpdate",{topic:"eventTriggered",subscriber:e}),()=>{s.sprChat("unsubscribeToUpdate",{topic:"eventTriggered",subscriber:e})}}),[c]),Object(n.useEffect)((()=>{const e=b()(r,(e=>!k.a.getCreativeId(e)));o()(e)||a.debug(`Available intercepts : ${JSON.stringify(e)}`)}),[r]),[r,c]},Ee=r(122),Te=r.n(Ee),ve=r(575),ge=r(479);var me=e=>{const t=be(),r=Object(n.useMemo)((()=>Te()(e,(e=>{let t=e;return k.a.getSnoozeConfig(e)&&(t=(e=>{const t=k.a.getFilter(e),r=k.a.getSnoozeConfig(e);if(o()(r))return e;const n={filterType:ve.a.LTE,field:ge.a.NUM_SNOOZE_ALLOWED,values:[r.maxSnoozeCount],details:{numSnoozes:r.maxSnoozeCount-r.currentSnoozeCount,nextSnoozeDuration:r.nextSnoozeDuration}};return t?{...e,filter:{filterType:ve.a.AND,filters:[n,t]}}:{...e,filter:n}})(t)),t}))),[e]);return Object(n.useEffect)((()=>{const e=b()(r,(e=>!k.a.getCreativeId(e)));o()(e)||t.debug(`Adapted intercepts : ${JSON.stringify(e)}`)}),[r]),r},he=r(1091),_e=r.n(he),je=r(47),fe=r.n(je),Ie=r(501),pe=r.n(Ie);const Ce=new Set([ge.a.IS_CONVERSATION_OPEN]),Se="EXCLUDE_LIVE_CHAT_FILTERS",ye="INCLUDE_LIVE_CHAT_FILTERS",Re=(e,t)=>{if(!o()(e)){if(e.filterType===ve.a.AND||e.filterType===ve.a.OR){if(o()(e.filters))return;const r=pe()(Te()(e.filters,(e=>Re(e,t))));return o()(r)?void 0:{...e,filters:r}}return t===ye&&Ce.has(e.field)||t===Se&&!Ce.has(e.field)?e:void 0}};var Le=r(1014),Ne=r(411);var Ae=()=>{const{subscribe:e,getValue:t}=Object(_.a)();return{subscribe:Object(n.useCallback)(((t,r)=>{const n=Ne.a.getId(t);return e(n,r)}),[e]),getValue:t}},ke=r(412),Pe=r.n(ke),Ve=r(431),De=r.n(Ve),we=r(196),Ue=r.n(we);var Ge=class{constructor(){this._startTime=void 0,this._endTime=void 0,this.start=()=>(this._startTime=this.getCurrentTime(),this._startTime),this.stop=()=>(this._endTime=this.getCurrentTime(),this._endTime),this.getCurrentTime=()=>Date.now(),this.getStartTime=()=>this._startTime,this.getEndTime=()=>this._endTime,this._startTime=0,this._endTime=0}};var Me=class{constructor(){this._clockInstance=void 0,this._totalTime=void 0,this.time=()=>(this._totalTime=this._clockInstance.getCurrentTime()-this._clockInstance.getStartTime(),this._totalTime),this._clockInstance=new Ge,this._totalTime=0,this._clockInstance.start()}};var xe=()=>Object(n.useCallback)((e=>{let{startTime:t,expectedTime:r,onTimeout:n}=e;const c=r-(t||Date.now());let a;return c>0&&(a=window.setTimeout((()=>{n()}),c)),a}),[]);var He=()=>{const e=xe(),t=Object(n.useRef)();t.current=Object(n.useMemo)((()=>new Me),[]);const r=Object(n.useRef)({});return{subscribe:Object(n.useCallback)(((n,c)=>{const a=Ne.a.getId(n),s=e({startTime:t.current.time(),expectedTime:De()(Ne.a.getValues(n)),onTimeout:c});return s&&(r.current={...r.current,[a]:{timeoutId:s}}),()=>{clearTimeout(Ue()(r.current,`${a}.timeoutId`)),r.current=Pe()(r.current,a)}}),[]),getValue:Object(n.useCallback)((()=>t.current.time()),[])}},Fe=r(123),$e=r.n(Fe);var We=class{constructor(){this._clockInstance=void 0,this._activeTime=void 0,this._visibilityChangeHandler=()=>{const{visibilityState:e}=document;"hidden"===e&&(this._clockInstance.stop(),this._activeTime+=this._clockInstance.getEndTime()-this._clockInstance.getStartTime()),"visible"===e&&this._clockInstance.start()},this.time=()=>"hidden"===document.visibilityState?this._activeTime:this._activeTime+(this._clockInstance.getCurrentTime()-this._clockInstance.getStartTime()),this._clockInstance=new Ge,"visible"===document.visibilityState&&this._clockInstance.start(),this._activeTime=0,document.addEventListener("visibilitychange",this._visibilityChangeHandler)}};var Qe=()=>{const e=xe(),t=Object(n.useRef)();t.current=Object(n.useMemo)((()=>new We),[]);const r=Object(n.useRef)({}),c=Object(n.useCallback)((()=>{"visible"===document.visibilityState&&$e()(r.current,((n,c)=>{const{onChangeCallback:a}=n,s=e({startTime:t.current.time(),expectedTime:De()(Ne.a.getValues(Ue()(n,"filter"))),onTimeout:a});s&&(r.current={...r.current,[c]:{...r.current[c],timeoutId:s}})})),"hidden"===document.visibilityState&&$e()(r.current,(e=>{const{timeoutId:t}=e;t&&window.clearTimeout(t)}))}),[]);Object(n.useEffect)((()=>(document.addEventListener("visibilitychange",c),()=>{document.removeEventListener("visibilitychange",c)})),[]);return{subscribe:Object(n.useCallback)(((n,c)=>{const a=Ne.a.getId(n);if("visible"===document.visibilityState){const s=e({startTime:t.current.time(),expectedTime:De()(Ne.a.getValues(n)),onTimeout:c});s&&(r.current={...r.current,[a]:{timeoutId:s,filter:n,onChangeCallback:c}})}return"hidden"===document.visibilityState&&(r.current={...r.current,[a]:{filter:n,onChangeCallback:c}}),()=>{clearTimeout(Ue()(r.current,`${a}.timeoutId`)),r.current=Pe()(r.current,a)}}),[]),getValue:Object(n.useCallback)((()=>t.current.time()),[])}};var Ze=class{constructor(){this._clockInstance=void 0,this._inactiveTime=void 0,this._visibilityChangeHandler=()=>{const{visibilityState:e}=document;"hidden"===e&&this._clockInstance.start(),"visible"===e&&(this._clockInstance.stop(),this._inactiveTime+=this._clockInstance.getEndTime()-this._clockInstance.getStartTime())},this.time=()=>"visible"===document.visibilityState?this._inactiveTime:this._inactiveTime+(this._clockInstance.getCurrentTime()-this._clockInstance.getStartTime()),this._clockInstance=new Ge,"hidden"===document.visibilityState&&this._clockInstance.start(),this._inactiveTime=0,document.addEventListener("visibilitychange",this._visibilityChangeHandler)}};var Be=()=>{const e=xe(),t=Object(n.useRef)();t.current=Object(n.useMemo)((()=>new Ze),[]);const r=Object(n.useRef)({}),c=Object(n.useCallback)((()=>{"visible"===document.visibilityState&&$e()(r.current,(e=>{const{timeoutId:t}=e;t&&window.clearTimeout(t)})),"hidden"===document.visibilityState&&$e()(r.current,((n,c)=>{const{onChangeCallback:a}=n,s=e({startTime:t.current.time(),expectedTime:De()(Ne.a.getValues(Ue()(n,"filter"))),onTimeout:a});s&&(r.current={...r.current,[c]:{...r.current[c],timeoutId:s}})}))}),[]);Object(n.useEffect)((()=>(document.addEventListener("visibilitychange",c),()=>{document.removeEventListener("visibilitychange",c)})),[]);return{subscribe:Object(n.useCallback)(((n,c)=>{const a=Ne.a.getId(n);if("hidden"===document.visibilityState){const s=e({startTime:t.current.time(),expectedTime:De()(Ne.a.getValues(n)),onTimeout:c});s&&(r.current={...r.current,[a]:{timeoutId:s,filter:n,onChangeCallback:c}})}return"visible"===document.visibilityState&&(r.current={...r.current,[a]:{filter:n,onChangeCallback:c}}),()=>{clearTimeout(Ue()(r.current,`${a}.timeoutId`)),r.current=Pe()(r.current,a)}}),[]),getValue:Object(n.useCallback)((()=>t.current.time()),[])}},Ye=r(1092),ze=r.n(Ye);var Ke=()=>{const e=Object(n.useRef)({}),t=Object(n.useContext)(v.a);return{subscribe:Object(n.useCallback)(((r,n)=>{const c=Ne.a.getId(r),a=De()(Ne.a.getValues(r));if(!t.getActionState(a)){const r=t.setSubscriber(a,(e=>{e===P.a.ENGAGE&&n()}));e.current={...e.current,[c]:{unsubscribeInterceptActionEvent:r}}}return()=>{const t=Ue()(e.current,`${c}.unsubscribeInterceptActionEvent`);t&&t(),e.current=Pe()(e.current,c)}}),[]),getValue:Object(n.useCallback)((()=>ze()(t.getActionDetails(),(e=>e.variants.some((e=>e.actionState===P.a.ENGAGE))))),[])}};var Je=()=>{const e=Object(n.useRef)({}),t=Object(n.useContext)(v.a);return{subscribe:Object(n.useCallback)(((r,n)=>{const c=Ne.a.getId(r),a=De()(Ne.a.getValues(r));if(!t.getActionState(a)){const r=t.setSubscriber(a,(e=>{e===P.a.CLOSE&&n()}));e.current={...e.current,[c]:{unsubscribeInterceptActionEvent:r}}}return()=>{const t=Ue()(e.current,`${c}.unsubscribeInterceptActionEvent`);t&&t(),e.current=Pe()(e.current,c)}}),[]),getValue:Object(n.useCallback)((()=>ze()(t.getActionDetails(),(e=>e.variants.some((e=>e.actionState===P.a.CLOSE))))),[])}};var Xe=()=>{const{getValue:e,subscribe:t}=Ke(),{getValue:r,subscribe:c}=Je(),a=Object(n.useRef)({});return{subscribe:Object(n.useCallback)(((t,n,c)=>{const s=Ne.a.getId(t);switch(c&&Ne.a.getField(c)){case ge.a.INTERCEPT_CLOSED_IN_SESSION_KEY:{const e=r(),i=De()(Ne.a.getValues(c)),u=()=>{const r=De()(Ne.a.getValues(t)),c=e[i]?e[i].variants:[],u=c[c.length-1].actionTime,o=r-(Date.now()-u);let l;o>0&&(l=window.setTimeout((()=>{n()}),o),a.current={...a.current,[s]:[()=>clearTimeout(l)]})};e[i]&&u();break}case ge.a.INTERCEPT_ENGAGED_IN_SESSION_KEY:{const r=e(),i=De()(Ne.a.getValues(c)),u=()=>{const e=De()(Ne.a.getValues(t)),c=r[i]?r[i].variants:[],u=c[c.length-1].actionTime,o=e-(Date.now()-u);let l;o>0&&(l=window.setTimeout((()=>{n()}),o),a.current={...a.current,[s]:[()=>clearTimeout(l)]})};r[i]&&u();break}}return()=>{Te()(a.current[s],(e=>e())),a.current=Pe()(a.current,s)}}),[])}},qe=r(523),et=r.n(qe),tt=r(579),rt=r.n(tt),nt=r(462);const ct="HORIZONTAL",at="VERTICAL",st=e=>{let{clientWindow:t,scrollDirection:r}=e;const n=t.document;let c,a;if(r===ct){const e=n.documentElement.scrollWidth;c=n.documentElement.scrollLeft+n.documentElement.clientWidth,a=e?Math.round(c/e*100):100}else{const e=n.documentElement.scrollHeight;c=n.documentElement.scrollTop+n.documentElement.clientHeight,a=e?Math.round(c/e*100):100}return{scrollDepth:c,scrollPercent:a}},it=e=>{const t=Object(nt.a)(),[r,c]=Object(n.useState)((()=>(e=>{let{clientWindow:t,scrollDirection:r}=e;return Object(nt.b)(t)?st({clientWindow:t,scrollDirection:r}):{scrollDepth:0,scrollPercent:0}})({clientWindow:t,scrollDirection:e})));return Object(n.useEffect)((()=>{if(Object(nt.b)(t)){const r=rt()((()=>{const r=st({clientWindow:t,scrollDirection:e});c(r)}),1e3);return t.addEventListener("scroll",r),()=>{t.removeEventListener("scroll",r)}}return ee.a}),[]),r};var ut=r(459),ot=r.n(ut);var lt=()=>{const e=Object(n.useRef)({});return{subscribe:Object(n.useCallback)(((t,r)=>{const n=Ne.a.getId(t),{start:c,end:a}=Ue()(t,"details.range[0]");let s,i;const u=c,o=ot()(a)?-1:a;return u>0&&(s=window.setTimeout((()=>{e.current={...e.current,[n]:{...e.current[n],timeLeftToGetInRange:0}},r()}),u)),o>0&&(i=window.setTimeout((()=>{e.current={...e.current,[n]:{...e.current[n],timeLeftToGetOutFromRange:0}},r()}),o)),e.current={...e.current,[n]:{...e.current[n],timeoutIdToGetInRange:s,timeoutIdToGetOutFromRange:i,timeLeftToGetInRange:u,timeLeftToGetOutFromRange:o}},()=>{clearTimeout(Ue()(e.current,`${n}.timeoutIdToGetInRange`)),clearTimeout(Ue()(e.current,`${n}.timeoutIdToGetOutFromRange`)),e.current=Pe()(e.current,n)}}),[]),getValue:Object(n.useCallback)((()=>t=>{const r=Ne.a.getId(t),{start:n,end:c}=Ue()(t,"details.range[0]");if(!ot()(n)&&!ot()(c)){const t=Ue()(e.current,`${r}.timeLeftToGetInRange`,0);return 0===Ue()(e.current,`${r}.timeLeftToGetOutFromRange`,0)?1:t}if(!ot()(n)){return Ue()(e.current,`${r}.timeLeftToGetInRange`)}return 0}),[])}};var bt=()=>{const{getValue:e,subscribe:t}=Ae(),{getValue:r,subscribe:c}=He(),{getValue:a,subscribe:s}=Qe(),{getValue:i,subscribe:u}=Be(),{getValue:o,subscribe:l}=Je(),{getValue:b,subscribe:d}=Ke(),{subscribe:O}=Xe(),{getValue:E,subscribe:T}=(()=>{const e=it(at),t=Object(n.useRef)({}),r=Object(n.useRef)(e);r.current=e,et()((()=>{Te()(t.current,(e=>{e()}))}),[e.scrollDepth,e.scrollPercent]);const c=Object(n.useCallback)(((e,r)=>{const n=Ne.a.getId(e);return t.current={...t.current,[n]:r},()=>{t.current=Pe()(t.current,n)}}),[]);return{getValue:Object(n.useCallback)((()=>({scrollDepth:r.current.scrollDepth,scrollPercent:r.current.scrollPercent})),[]),subscribe:c}})(),{getValue:v,subscribe:g}=(()=>{const e=it(ct),t=Object(n.useRef)({}),r=Object(n.useRef)(e);r.current=e,et()((()=>{Te()(t.current,(e=>{e()}))}),[e.scrollDepth,e.scrollPercent]);const c=Object(n.useCallback)(((e,r)=>{const n=Ne.a.getId(e);return t.current={...t.current,[n]:r},()=>{t.current=Pe()(t.current,n)}}),[]);return{getValue:Object(n.useCallback)((()=>({scrollDepth:r.current.scrollDepth,scrollPercent:r.current.scrollPercent})),[]),subscribe:c}})(),{getValue:m,subscribe:h}=(()=>{const e=Object(n.useRef)({});return{subscribe:Object(n.useCallback)(((t,r)=>{const n=Ne.a.getId(t),c=De()(Ne.a.getValues(t));let a;return c>0&&(a=window.setTimeout((()=>{e.current={...e.current,[n]:{...e.current.id,timeLeft:0}},r()}),c)),e.current={...e.current,[n]:{timeoutId:a,timeLeft:c}},()=>{window.clearTimeout(Ue()(e.current,`${n}.timeoutId`)),e.current=Pe()(e.current,n)}}),[]),getValue:Object(n.useCallback)((()=>t=>{const r=Ne.a.getId(t);return Ue()(e.current,`${r}.timeLeft`,0)}),[])}})(),{getValue:_,subscribe:j}=(()=>{const e=xe(),t=Object(n.useRef)(new Me),r=Object(n.useRef)({});return{subscribe:Object(n.useCallback)(((n,c)=>{const a=Ne.a.getId(n),s=Ue()(Ne.a.getDetails(n),"nextSnoozeDuration",0),i=t.current.time(),u=e({startTime:i,expectedTime:i+s,onTimeout:()=>{r.current={...r.current,[a]:{...r.current.id,timeLeft:0}},c()}});return u&&(r.current={...r.current,[a]:{timeoutId:u,timeLeft:s}}),()=>{clearTimeout(Ue()(r.current,`${a}.timeoutId`)),r.current=Pe()(r.current,a)}}),[]),getValue:Object(n.useCallback)((()=>e=>{const t=Ne.a.getId(e);return Ue()(r.current,`${t}.timeLeft`,0)}),[])}})(),{getValue:f,subscribe:I}=lt();return{getValue:Object(n.useCallback)((()=>({[ge.a.CURRENT_URL]:e(),[ge.a.TOTAL_TIME_SPENT]:r(),[ge.a.ACTIVE_TIME_SPENT]:a(),[ge.a.INACTIVE_TIME_SPENT]:i(),[ge.a.INTERCEPT_ENGAGED_IN_SESSION_KEY]:b(),[ge.a.INTERCEPT_CLOSED_IN_SESSION_KEY]:o(),[ge.a.VERTICAL_PAGE_SCROLL_DEPTH]:E(),[ge.a.HORIZONTAL_PAGE_SCROLL_DEPTH]:v(),[ge.a.TIME_SPENT_ON_SESSION]:m(),[ge.a.NUM_SNOOZE_ALLOWED]:_(),[ge.a.BUSINESS_HOURS]:f()})),[e,r,a,i,o,b,E,v,m,_,f]),subscribe:Object(n.useCallback)(((e,r,n)=>{switch(Ne.a.getField(e)){case ge.a.TOTAL_TIME_SPENT:return c(e,r);case ge.a.CURRENT_URL:return t(e,r);case ge.a.ACTIVE_TIME_SPENT:return s(e,r);case ge.a.INACTIVE_TIME_SPENT:return u(e,r);case ge.a.INTERCEPT_CLOSED_IN_SESSION_KEY:return l(e,r);case ge.a.INTERCEPT_ENGAGED_IN_SESSION_KEY:return d(e,r);case ge.a.DEPENDENT_DURATION_KEY:return O(e,r,n);case ge.a.VERTICAL_PAGE_SCROLL_DEPTH:return T(e,r);case ge.a.HORIZONTAL_PAGE_SCROLL_DEPTH:return g(e,r);case ge.a.TIME_SPENT_ON_SESSION:return h(e,r);case ge.a.NUM_SNOOZE_ALLOWED:return j(e,r);case ge.a.BUSINESS_HOURS:return I(e,r);default:return ee.a}}),[t,c,s,u,l,d,O,T,g,h,j,I])}},dt=r(410);var Ot=(e,t)=>{const{_getStaticValueMap:r=ee.a}=t||dt.a,{getValue:c,subscribe:a}=bt(),s=Object(n.useCallback)((()=>({...r(),...c()})),[c,r]);return Object(Le.a)(e,{...t,getValue:s,subscribe:a})};var Et=e=>{const[t,r]=Object(n.useState)(0),c=Object(n.useRef)([]),a=Object(n.useRef)({}),s=Object(A.b)();return Object(n.useMemo)((()=>{o()(e)?c.current=[{hasPassed:!0}]:c.current=Te()(e,(e=>{let{id:t,filter:r}=e;const n=o()(r)||a.current[t];return delete a.current[t],{hasPassed:n}}))}),[e]),Object(n.useEffect)((()=>{if(!o()(pe()(Te()(e,"filter")))){const t=re.a.v4(),n=t=>{let{response:n}=t;n&&n.data&&(c.current=Te()(e,((e,t)=>{let{id:r,filter:c}=e;return a.current[r]=!c||n.data.results[t],{hasPassed:a.current[r]}})),r((e=>e+1)))};return s.sprChat("subscribeToUpdate",{topic:"addFilterToEvaluate",subscriber:n}),s.sprChat("addFilterToEvaluate",{id:t,filters:Te()(e,"filter")}),()=>{s.sprChat("unsubscribeToUpdate",{topic:"addFilterToEvaluate",subscriber:n}),s.sprChat("removeFilterToEvaluate",{id:t})}}return ee.a}),[e]),c.current};var Tt=e=>{const t=Object(n.useRef)([]),r=be(),{interceptsWithoutLiveChatFilterToEvaluate:c,interceptsOnlyWithLiveChatFilterToEvaluate:a}=Object(n.useMemo)((()=>fe()(e,((e,t)=>{const r=Re(k.a.getFilter(t),Se),n=Re(k.a.getFilter(t),ye);return{interceptsWithoutLiveChatFilterToEvaluate:[...e.interceptsWithoutLiveChatFilterToEvaluate,r],interceptsOnlyWithLiveChatFilterToEvaluate:[...e.interceptsOnlyWithLiveChatFilterToEvaluate,{id:k.a.getId(t),filter:n}]}}),{interceptsWithoutLiveChatFilterToEvaluate:[],interceptsOnlyWithLiveChatFilterToEvaluate:[]})),[e]),s=Ot(c,{defaultValue:!0}),i=Et(a);return Object(n.useMemo)((()=>{t.current=[],Te()(e,((e,r)=>{s[r].hasPassed&&i[r].hasPassed&&(t.current=[...t.current,e])}))}),[s,i,e]),Object(n.useEffect)((()=>{const e=b()(t.current,(e=>!k.a.getCreativeId(e)));o()(e)||r.debug(`filterPassedIntercepts : ${JSON.stringify(e)}`)}),[t.current]),t.current},vt=r(547);const gt=(e,t)=>t?fe()(k.a.getTargets(e),((e,r,n)=>({...e,[n]:{...r,additional:t[r.value]}})),{}):k.a.getTargets(e);var mt=r(446);const ht="/livechat/prompt";async function _t(e){return(await mt.a.get(`${ht}/creative/${e}`)).data}async function jt(e){return(await mt.a.post(`${ht}/fetch/survey`,e)).data}const ft=["snoozeConfig"];var It=e=>{const[t,r]=Object(n.useState)(0),c=Object(n.useRef)([]),a=Object(n.useRef)({}),s=be();return Object(n.useMemo)((()=>{c.current=[],Te()(e,(e=>{if(!e)return;if(!k.a.getCreativeId(e))return void s.debug(`Intercept resolver : ${JSON.stringify(e)}`);if(!o()(a.current[k.a.getId(e)]))return void c.current.push({...e,...Pe()(a.current[k.a.getId(e)],ft)});const t=(e=>{const t=k.a.getId(e),r=fe()(k.a.getTargets(e),((e,t)=>t.type===vt.a.SURVEY||t.type===vt.a.SURVEY_INLINE?{...e,surveyURLs:e.surveyURLs?[...e.surveyURLs,t.value]:[t.value]}:e),{});return o()(r)?void 0:{...r,variantId:t}})(e);Promise.all([_t(k.a.getCreativeId(e)),t?jt(t):Promise.resolve(void 0)]).then((t=>{let[n,s]=t;const i={...e,creative:n,targets:gt(e,s)};a.current[k.a.getId(e)]=i,c.current=[...c.current,i],r((e=>e+1))})).catch((e=>{Object(Y.b)(e)}))}))}),[e,r]),c.current};var pt=e=>{const t=Object(n.useRef)([]),r=Tt(e),c=It(r);return Object(n.useMemo)((()=>{t.current=O()([..._e()(t.current,c,"id"),...c],"id")}),[c]),t.current},Ct=r(642);const St=new Set([vt.a.LIVE_CHAT_EXECUTE_RULE,vt.a.LIVE_CHAT_ROUTE_TO_BOT,vt.a.LIVE_CHAT_WITH_AGENT,vt.a.CHAT_WITH_AGENT,vt.a.ROUTE_TO_BOT,vt.a.EXECUTE_RULE]);var yt=e=>{const[t,r]=Object(n.useState)([]),c=Object(A.b)();return Object(n.useEffect)((()=>{const t=t=>{const n=t?e:(e=>fe()(e,((e,t)=>{let r=!1;return $e()(k.a.getTargets(t),(e=>{if(St.has(Ct.a.getType(e)))return r=!0,!1})),r?e:[...e,t]}),[]))(e);r((e=>O()([..._e()(e,n,"id"),...n],"id")))};return c.sprChat("onAvailabilityChange",t),()=>{c.sprChat("offAvailabilityChange",t)}}),[r,e,c]),t};const Rt="REMOVE_INTERCEPT";var Lt=function(){const[e,t]=Oe(),r=me(e),c=pt(r);return[yt(c),Object(n.useCallback)((e=>{e.type===Rt&&t({type:w,payload:{interceptIds:[e.payload.interceptId]}})}),[])]},Nt=r(391),At=r(859),kt=r(401);const Pt="POPUP",Vt="LIVECHAT",Dt="POSITIONED_POPUP",wt=Object(kt.a)((()=>r.e(43).then(r.bind(null,1869)))),Ut=Object(kt.a)((()=>r.e(44).then(r.bind(null,1859)))),Gt=Object(kt.a)((()=>r.e(38).then(r.bind(null,1870)))),Mt=new Set([Pt,Vt,Dt]),xt=e=>{const{intercepts:t}=e,r=Object(n.useMemo)((()=>fe()(t,((e,t)=>{const r=At.a.getType(k.a.getCreative(t));return Mt.has(r)&&e[r].push(t),e}),{[Pt]:[],[Vt]:[],[Dt]:[]})),[t]),a=r[Pt],s=r[Dt],u=r[Vt];return Object(i.jsx)(c.a.Fragment,null,o()(a)?null:Object(i.jsx)(n.Suspense,{fallback:null},Object(i.jsx)(wt,Object(Nt.a)({},e,{intercepts:a}))),o()(u)?null:Object(i.jsx)(n.Suspense,{fallback:null},Object(i.jsx)(Gt,Object(Nt.a)({},e,{intercepts:u}))),o()(s)?null:Object(i.jsx)(n.Suspense,{fallback:null},Object(i.jsx)(Ut,Object(Nt.a)({},e,{intercepts:s}))))};var Ht=c.a.memo(xt);var Ft=()=>{const[e,t]=Lt(),r=Object(n.useCallback)((e=>{t({type:Rt,payload:{interceptId:e}})}),[t]);return o()(e)?null:Object(i.jsx)(Ht,{intercepts:e,onClose:r})},$t=r(860),Wt=r(1041);var Qt=function(e){const t=Object(Wt.a)(e.window);return Object(i.jsx)($t.a.Provider,{value:t},e.children)};var Zt=class{constructor(){this._map=void 0,this._map={}}addEntry(e){this._map[e]||(this._map[e]={subscribers:[],variants:[]})}setAction(e,t){const r=(e=>{const t=e.indexOf("_");return-1!==t?e.substring(0,t):e})(e),n=Date.now();this.addEntry(r),this._map[r].variants=[...this._map[r].variants,{actionState:t,actionTime:n,id:e}],this._map[r].subscribers.forEach((e=>{e(t)})),this._map[r].subscribers=[]}setSubscriber(e,t){return this.addEntry(e),this._map[e].subscribers.push(t),()=>{this._map[e].subscribers=this._map[e].subscribers.filter((e=>e!==t))}}getActionState(e,t){const r=this._map[e]&&this._map[e].variants;if(r&&r.length){const e=r.find((e=>e.id===t));return t?e&&e.actionState:r[r.length-1].actionState}}getActionDetails(){return this._map}};var Bt=()=>Object(n.useRef)(new Zt).current,Yt=r(634);const zt=e=>{const t=Object(A.b)(),r=Bt(),c=Object(n.useMemo)((()=>Object(Yt.a)(t.document)),[t.document]);return Object(i.jsx)(i.CacheProvider,{value:c},Object(i.jsx)(Qt,{window:t},Object(i.jsx)(M.Provider,{value:e.handshakeDetails},Object(i.jsx)(v.a.Provider,{value:r},Object(i.jsx)(le,null,Object(i.jsx)(Ft,null))))))};var Kt=c.a.memo(zt),Jt=r(1019);function Xt(e,t){const r=Object(Jt.a)();s.a.render(Object(i.jsx)(Kt,{handshakeDetails:t}),r)}},483:function(e,t,r){"use strict";var n=r(384),c=r(518),a=r.n(c);const s="DATA_LOADING",i="DATA_LOADED",u="DATA_UPDATED",o="DATA_LOAD_FAILED",l="DATA_FETCHING_MORE",b={loading:!1,error:void 0,data:void 0},d=(e,t)=>{switch(t.type){case s:return{...e,loading:!0,data:void 0,error:void 0};case l:return{...e,loading:!0,error:void 0};case i:return{...e,loading:!1,data:t.payload};case o:return{...e,loading:!1,error:t.payload};case u:return{...e,data:t.payload};default:return e}};var O=()=>Object(n.useReducer)(d,b),E=r(423),T=r(446),v=r(430);const g=(e,t)=>t!==e.current;t.a=e=>{let{query:t,skipQueryOnMount:r,payload:c,onCompleted:b,options:d}=e;const[m,h]=O(),{loading:_,data:j,error:f}=m,I=Object(n.useRef)(null),p=Object(n.useRef)(j);p.current=j;const C=E.a.getType(t),S=E.a.getUrl(t),y=Object(n.useRef)(b);y.current=b;const R=Object(n.useCallback)((()=>{I.current=null}),[]),L=Object(n.useCallback)((async(e,t)=>{let r;if(R(),I.current=t,r=C===v.a.GET||C===v.a.REMOVE?await T.a[C](S,d):await T.a[C](S,e,d),!g(I,t))return y.current&&y.current(r.data),r}),[C,S]),N=Object(n.useCallback)((async e=>{h({type:s,payload:{}});const t=a()("reqId");try{const r=await L(e,t);g(I,t)||h({type:i,payload:r.data})}catch(r){g(I,t)||h({type:o,payload:r})}}),[L]);Object(n.useEffect)((()=>{r||N(c)}),[]);const A=Object(n.useCallback)((async(e,t)=>{h({type:l,payload:{}});const r=a()("reqId");try{const n=await L(e,r);if(!g(I,r)){let e=n.data;t&&(e=t(p.current,n.data)),h({type:i,payload:e})}}catch(n){g(I,r)||h({type:o,payload:n})}}),[L]),k=Object(n.useCallback)(((e,t)=>{t?A(e,t):N(e)}),[N]),P=Object(n.useCallback)((e=>{h({type:u,payload:e(p.current)})}),[]);return{loading:_,data:j,error:f,refetch:k,fetchMore:A,updateQuery:P}}},491:function(e,t,r){"use strict";r.d(t,"a",(function(){return E}));var n=r(7),c=r(1872),a=r(6);const s=Object(n.a)("id"),i=Object(n.a)("creativeId"),u=Object(n.a)("targets"),o=Object(c.a)(["creative","socialAsset","content"]),l=Object(n.a)("settings"),b=Object(n.a)("filter"),d=Object(n.a)("snoozeConfig"),O=Object(c.a)(["additional","surveyResponseId"]);class E{}E.getId=Object(a.a)(s),E.getCreativeId=Object(a.a)(i),E.getTargets=Object(a.a)(u),E.getCreative=Object(a.a)(o),E.getFilter=Object(a.a)(b),E.getSettings=Object(a.a)(l),E.getSnoozeConfig=Object(a.a)(d),E.getSurveyResponseId=Object(a.a)(O)},524:function(e,t,r){"use strict";r.d(t,"a",(function(){return n}));const n={PAGE_VISIT:"PAGE_VISIT",TAB_CHANGE:"TAB_CHANGE",TAB_CLOSE:"TAB_CLOSE",INTERCEPT_SNOOZE_TRIGGERED:"INTERCEPT_SNOOZE_TRIGGERED",INTERCEPT_TRIGGERED:"INTERCEPT_TRIGGERED",INTERCEPT_CLOSED:"INTERCEPT_CLOSED",INTERCEPT_ENGAGED:"INTERCEPT_ENGAGED",SNOOZE:"SNOOZE"}},545:function(e,t,r){var n=r(127),c=r(732);e.exports=function(e,t){return e&&e.length?c(e,n(t,2)):[]}},547:function(e,t,r){"use strict";r.d(t,"a",(function(){return n}));const n={LIVE_CHAT_ROUTE_TO_BOT:"LIVE_CHAT_ROUTE_TO_BOT",LIVE_CHAT_EXECUTE_RULE:"LIVE_CHAT_EXECUTE_RULE",LIVE_CHAT_WITH_AGENT:"LIVE_CHAT_WITH_AGENT",CLOSE:"CLOSE",SURVEY:"SURVEY",SURVEY_INLINE:"SURVEY_INLINE",CHAT_WITH_AGENT:"CHAT_WITH_AGENT",ROUTE_TO_BOT:"ROUTE_TO_BOT",EXECUTE_RULE:"EXECUTE_RULE",REMOVE:"REMOVE",SNOOZE:"SNOOZE",URL:"OPEN_URL"}},563:function(e,t,r){"use strict";r.d(t,"a",(function(){return n}));const n={CLOSE:"CLOSE",ENGAGE:"ENGAGE",TRIGGERED:"TRIGGERED",SNOOZE:"SNOOZE"}},595:function(e,t,r){"use strict";r.d(t,"a",(function(){return c}));var n=r(384);const c=()=>{const[e,t]=Object(n.useState)("visible"===document.visibilityState);return Object(n.useEffect)((()=>{const e=()=>{const{visibilityState:e}=document;"hidden"===e&&t(!1),"visible"===e&&t(!0)};return document.addEventListener("visibilitychange",e),()=>{document.removeEventListener("visibilitychange",e)}}),[]),e}},598:function(e,t,r){"use strict";var n=r(384);const c=r.n(n).a.createContext(void 0);t.a=c},641:function(e,t,r){"use strict";var n=r(384),c=r(82),a=r.n(c),s=r(483),i=r(595),u=r(423),o=r(454),l=r(430);const b=(new u.a).setUrl("/livechat/prompt/browse/event").setType(l.a.POST).build();t.a=function(){let{skipQueryOnMount:e,payload:t}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{skipQueryOnMount:!1};const{refetch:r,...c}=Object(s.a)({query:b,skipQueryOnMount:e,payload:{...t,sourceType:"PROACTIVE_PROMPT"}}),u=Object(n.useRef)([]),l=Object(i.a)(),d=Object(n.useRef)(l);d.current=l;const O=Object(n.useCallback)((e=>{const t={...e,sourceType:"PROACTIVE_PROMPT",page:Object(o.a)().pageUrl,userAgent:Object(o.a)().userAgent,timeZone:Object(o.a)().timeZone};d.current?r(t):u.current=[...u.current,t]}),[r]);return Object(n.useEffect)((()=>{l&&!a()(u.current)&&(r(u.current),u.current=[])}),[l]),{...c,refetch:O}}},642:function(e,t,r){"use strict";r.d(t,"a",(function(){return u}));var n=r(7),c=r(6);const a=Object(n.a)("type"),s=Object(n.a)("value"),i=Object(n.a)("additional");class u{}u.getType=Object(c.a)(a),u.getValue=Object(c.a)(s),u.getAdditional=Object(c.a)(i)},859:function(e,t,r){"use strict";r.d(t,"a",(function(){return s}));var n=r(7),c=r(6);const a=Object(n.a)("type");class s{}s.getType=Object(c.a)(a)},860:function(e,t,r){"use strict";var n=r(384);const c=r.n(n).a.createContext({height:0,width:0});t.a=c}}]);